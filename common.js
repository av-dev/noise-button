function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){function n(o,s){try{var r=e[o](s),a=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(a).then(function(t){n("next",t)},function(t){n("throw",t)});t(a)}return n("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length&&!window.CP.shouldStopExecution(1)&&!window.CP.shouldStopExecution(1);i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}window.CP.exitedLoop(1),window.CP.exitedLoop(1)}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),NoiseButton=function(t){function e(t){var i,n=this;_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{autoStart:!1,autoResize:!0,transparent:!0}));return o.resize=e.debounce(_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;){if(window.CP.shouldStopExecution(2))break;if(window.CP.shouldStopExecution(2))break;switch(t.prev=t.next){case 0:o.setSize()&&(o.container.removeChildren(0,o.container.children.length-1),o.addGraphics(),o.createTimeLine(),o.render());case 1:case"end":return t.stop()}}window.CP.exitedLoop(2),window.CP.exitedLoop(2)},t,n)})),o,100),o.options=Object.assign({},{backgroundColor:4748748,backgroundAlpha:1,polygon:"0, 0, 0, 0",borderColor:4748748,borderWidth:0,wavesAlpha:1,displacementScale:{x:30,y:50},displacementMap:"http://digitalfreepen.com/images/2017/whitenoise.png"},t),o.polygon=o.options.polygon.replace(/\s/g,"").split(",").map(function(t){var e=0|t;return e>o.options.borderWidth?e-o.options.borderWidth/2:e}),o.offset=20,o.animate=!1,i=o.createCanvas(),_possibleConstructorReturn(o,i)}return _inherits(e,t),_createClass(e,[{key:"createCanvas",value:function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;){if(window.CP.shouldStopExecution(3))break;if(window.CP.shouldStopExecution(3))break;switch(t.prev=t.next){case 0:return this.options.element.classList.add("noise-container"),this.view.classList.add("noise-canvas"),this.options.element.appendChild(this.view),this.container=new PIXI.Container,this.stage.addChild(this.container),t.next=7,this.loadTexture(this.options.waves);case 7:e=t.sent,this.waves=new PIXI.Sprite(e),this.noiseSprite=PIXI.Sprite.fromImage(this.options.displacementMap),this.setSize(),this.addGraphics(),this.bindEvents(),this.render(),this.options.element.classList.add("canvas-ready");case 15:case"end":return t.stop()}}window.CP.exitedLoop(3),window.CP.exitedLoop(3)},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"addGraphics",value:function(){this.container.addChild(this.getPolygon(!0)),this.options.waves&&this.drawWaves();var t=new PIXI.Graphics;t.beginFill(0,0),t.drawRect(0,0,this.width,this.width),this.container.addChild(t),this.container.addChild(this.getPolygon()),this.setMask(),this.addFilter()}},{key:"setMask",value:function(){var t=this.getPolygon();this.stage.addChild(t),this.container.mask=t}},{key:"drawWaves",value:function(){this.waves.alpha=1-this.options.wavesAlpha,this.waves.y=this.height*this.options.wavesPos.y,this.container.addChild(this.waves),this.waves.width=this.waves.height=this.width}},{key:"setSize",value:function(){var t=this.options.element.offsetWidth,e=this.options.element.offsetHeight;return this.width=t+2*this.offset,this.height=e+2*this.offset,this.oldWidth!==this.width&&(this.renderer.resize(this.width,this.height),this.oldWidth=this.width,!0)}},{key:"loadTexture",value:function(t){return new Promise(function(e){var i=new PIXI.loaders.Loader;i.add("waves",t),i.load(function(t,i){return e(i.waves.texture)})})}},{key:"addFilter",value:function(){this.container.addChild(this.noiseSprite),this.noiseFilter=new PIXI.filters.DisplacementFilter(this.noiseSprite),this.container.filters=[this.noiseFilter],this.noiseSprite.position.x=-this.width,this.noiseSprite.width=3*this.width,this.noiseFilter.scale.x=0,this.noiseFilter.scale.y=0}},{key:"createTimeLine",value:function(){var t=this;this.timeline=new TimelineMax({onUpdate:this.render.bind(this),paused:!0,onStart:function(){return t.animate=!0},onComplete:function(){return t.animate=!1}}).to(this.noiseFilter.scale,.2,{x:this.options.displacementScale.x,y:this.options.displacementScale.y}).fromTo(this.noiseSprite,.5,{x:-.66*this.noiseSprite.width},{x:0},"-=.2").to(this.noiseFilter.scale,.2,{x:0,y:0},"-=.2")}},{key:"play",value:function(){this.animate||this.timeline.play(0)}},{key:"bindEvents",value:function(){this.createTimeLine(),this.options.element.addEventListener("mouseenter",this.play.bind(this)),window.addEventListener("resize",this.resize.bind(this))}},{key:"getPolygon",value:function(t){var e=this.polygon,i=new PIXI.Graphics,n=this.width-2*this.offset-this.options.borderWidth,o=this.height-2*this.offset-this.options.borderWidth;i.position.x=this.offset+this.options.borderWidth/2,i.position.y=this.offset+this.options.borderWidth/2;var s=[[0,e[0]],[e[0],0],[n-e[1],0],[n,e[1]],[n,o-e[2]],[n-e[2],o],[e[3],o],[0,o-e[3]],[0,e[0]]];i.lineStyle(this.options.borderWidth,this.options.borderColor),i.beginFill(this.options.backgroundColor,t?1-this.options.backgroundAlpha:0);for(var r=0,a=[];r<s.length&&!window.CP.shouldStopExecution(4)&&!window.CP.shouldStopExecution(4);r++)a.length&&a[0]===s[r][0]&&a[1]===s[r][1]||(0!==r?(a=s[r],i.lineTo(s[r][0],s[r][1])):(i.moveTo(s[r][0],s[r][1]),a=s[r]));return window.CP.exitedLoop(4),window.CP.exitedLoop(4),i.endFill(),i}}],[{key:"debounce",value:function(t,e,i,n){var o=arguments,s=void 0;return function(){var r=o,a=n&&!s;clearTimeout(s),s=setTimeout(function(){s=null,n||t.apply(e,r)},i),a&&t.apply(e,r)}}}]),e}(PIXI.Application);
